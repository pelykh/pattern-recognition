# Лабораторна робота №9. Обробка зображення
### Мета роботи
Навчитися виконувати геометричне вирівнювання; морфологічні операції ерозії, дилатації, відкриття, замикання та застосовувати фільтри згладжування.

### Теоретичні відомості
Проблема вирівнювати зображення постає тоді, коли камера дивиться збоку на площину. Тоді слід вирівняти отриману картинку так, ніби камера дивиться строго зверху.

Для цього використовують перспективне перетворення, яке полягає у наступному:
1. Необхідно вказати координати декількох точок на зображенні і вказати в які точки вони повинні перейти.
Потрібно не менше 4 точок для для пошуку перспективної проекції. Причому будь-які
три точки не повинні лежати на одній прямій.
В найпростішому випадку це просто 4 точки, що вказують, куди
повинні перейти кути зображення: (A,B,C,D) -> [0,w] x [0,h]
2. Матрица перспективного перетворення M здійснює перетворення по правилу
(x,y) -> M *(x,y,1) T
За допомогою ф-ї getPerspectiveTransform знаходимо оптимальну матрицю перспективного перетворення
OpenCV використовує 4 точки.
3. Дана матриця підставляється в ф-ю warpPerspective для отримання каліброваного зображення.

Можна зробити білінійне перетворення.
В цьому випадку формула простіша, але працює по іншому і використовується коли потрібно перевести прямокутник в довільний 4-кутник

До бінарних зображень можна застосовувати різні операції типу «стискання», «роздування» на один піксель.
Ці питання вивчає математична морфологія.
Дві основні операції – це ерозія (стискання) та дилатація (розбивання) за допомогою довільної межі.

Розглянемо в якості такої множини дискретний круг радіуса r.
- Ерозія – R-внутрішність множини. Лишає у вхідній множині Q лише ті пікселі, які містились в початковій множині разом з кругом R з центром в пікселі.
- Дилатація – R-окіл множини. Результатом застосування до Q є об’єднання всіх кругів радіуса R з центром пікселя із Q .
- Відкриття - це ерозія + дилатація. Усунення маленьких шумів та «наростів».
- Замикання - це дилатація + ерозія.Усунення маленьких дірок.

### Код програми з поясненнями
Персективне перетворення відбувається за допомогою методу `warpPerspective`, проте перед тим необхідно визначити матрицю перетворення `M` за допомогою методу `getPerspectiveTransform`.
```javascript
const M = cv.getPerspectiveTransform(srcCoords, finalDestCoords);
cv.warpPerspective(src, dst, M, dsize, cv.INTER_LINEAR, cv.BORDER_CONSTANT, new cv.Scalar());
```
![](9_perspective_transform.png)

Ерозія виконується за допомогою методу `erode`, проте попередньо задаємо `M`, у моєму випадку це матриця з одиниць.
```javascript
let M = cv.Mat.ones(5, 5, cv.CV_8U);
let anchor = new cv.Point(-1, -1);
cv.erode(src, dst, M, anchor, 1, cv.BORDER_CONSTANT, cv.morphologyDefaultBorderValue());
```
![](9_erosion.png)

Аналогічно відбувається дилатація за домогою методу `dilate`.
```javascript
const M = cv.Mat.ones(5, 5, cv.CV_8U);
const anchor = new cv.Point(-1, -1);
cv.dilate(src, dst, M, anchor, 1, cv.BORDER_CONSTANT, cv.morphologyDefaultBorderValue());
```
![](9_dilation.png)

Відкриття це послідовність операцій ерозія та дилатація, використовуємо метод `morphologyEx` з аргументом `cv.MORPH_OPEN`.
```javascript
let M = cv.Mat.ones(5, 5, cv.CV_8U);
let anchor = new cv.Point(-1, -1);
cv.morphologyEx(src, dst, cv.MORPH_OPEN, M, anchor, 1, cv.BORDER_CONSTANT, cv.morphologyDefaultBorderValue());
```
![](9_opening.png)

Pfrhbnnz це послідовність операцій дилатація та ерозія, використовуємо метод `morphologyEx` з аргументом `cv.MORPH_CLOSE`.
```javascript
let M = cv.Mat.ones(5, 5, cv.CV_8U);
let anchor = new cv.Point(-1, -1);
cv.morphologyEx(src, dst, cv.MORPH_CLOSE, M, anchor, 1, cv.BORDER_CONSTANT, cv.morphologyDefaultBorderValue());
```
![](9_closing.png)

Медіане розмиття відбувається за домопогою методу `medianBlur`, нам потрібно лише задати ядро (має обов'язково бути непарним числом).
```javascript
cv.medianBlur(src, dst, power);
```
Ось кадри зі створеного відео послідовного розмиття зображення.
![](9_1.png)
![](9_2.png)
![](9_3.png)
### Висновки
Отже, на даній лабораторній роботі ми навчилися виконувати геометричне вирівнювання, морфологічні операції ерозії, дилатації, відкриття, замикання та застосовувати фільтри згладжування.
